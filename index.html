<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>For Natasha üíò</title>

  <style>
    :root{
      --bg1:#ffd1e8;
      --bg2:#fff0c9;
      --bg3:#c9f3ff;
      --ink:#2b1b2b;
      --muted: rgba(0,0,0,0.70);

      --pink:#ff4fa3;
      --rose:#ff2f7d;
      --purple:#7b3ff2;
      --aqua:#00b4ff;

      --card:#ffffff;
      --cream:#fff7ee;

      --shadow: 0 16px 0 rgba(0,0,0,0.08), 0 28px 60px rgba(0,0,0,0.18);
      --stroke: rgba(0,0,0,0.16);
      --stroke2: rgba(0,0,0,0.12);

      --radius: 26px;
      --ease: cubic-bezier(.2,.85,.2,1);

      --font: ui-rounded, "Comic Sans MS", "Trebuchet MS", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--ink);
      overflow-x:hidden;
      background:
        radial-gradient(900px 700px at 15% 10%, rgba(255,79,163,0.35), transparent 55%),
        radial-gradient(900px 700px at 85% 20%, rgba(123,63,242,0.20), transparent 60%),
        radial-gradient(900px 700px at 50% 100%, rgba(0,180,255,0.18), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }

    /* Cute dotted doodle overlay */
    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.14;
      background-image:
        radial-gradient(circle at 12px 12px, rgba(0,0,0,.12) 2px, transparent 2.2px),
        radial-gradient(circle at 42px 32px, rgba(0,0,0,.08) 1.6px, transparent 1.8px);
      background-size: 72px 72px;
      z-index:0;
    }

    /* Sticker corners */
    .sticker{
      position: fixed;
      z-index: 1;
      filter: drop-shadow(0 12px 0 rgba(0,0,0,0.08)) drop-shadow(0 18px 30px rgba(0,0,0,0.18));
      user-select:none;
      pointer-events:none;
      animation: floaty 3.6s var(--ease) infinite;
      font-size: 40px;
    }
    .sticker.s1{ left: 12px; top: 10px; transform: rotate(-12deg); }
    .sticker.s2{ right: 12px; top: 10px; transform: rotate(10deg); animation-delay: .4s; }
    .sticker.s3{ left: 12px; bottom: 10px; transform: rotate(8deg); animation-delay: .8s; }
    .sticker.s4{ right: 12px; bottom: 10px; transform: rotate(-8deg); animation-delay: 1.2s; }

    @keyframes floaty{
      0%,100%{ transform: translateY(0) rotate(var(--r, 0deg)); }
      50%{ transform: translateY(-8px) rotate(var(--r, 0deg)); }
    }

    /* Canvas layers */
    .layer{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:2;
    }

    /* Top music banner */
    .topBanner{
      position: fixed;
      left: 12px;
      right: 12px;
      top: 12px;
      z-index: 10;
      display:none;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 12px 12px;
      border-radius: 999px;
      background: #fff;
      border: 3px solid var(--stroke);
      box-shadow: 0 14px 0 rgba(0,0,0,0.08), 0 20px 40px rgba(0,0,0,0.12);
    }
    .topBanner.show{ display:flex; }
    .topBanner .msg{
      font-weight: 1000;
      font-size: 13.5px;
      color: rgba(0,0,0,0.78);
      line-height: 1.2;
    }
    .topBanner button{
      min-width:auto;
      padding: 10px 12px;
      font-weight: 1100;
      border-radius: 999px;
      border: 3px solid var(--stroke);
      background: linear-gradient(180deg, #ff79bd, #ff2f7d);
      color: #fff;
      box-shadow: 0 10px 0 rgba(0,0,0,0.08);
      cursor:pointer;
    }
    .topBanner button:active{ transform: translateY(3px); box-shadow: 0 7px 0 rgba(0,0,0,0.08); }

    .wrap{
      position:relative;
      z-index:3;
      min-height:100%;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding: 72px 16px 72px; /* extra top padding for banner */
    }

    .shell{
      width:min(1020px, 100%);
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 18px;
      align-items:stretch;
    }
    @media (max-width: 980px){
      .shell{ grid-template-columns: 1fr; }
    }

    .card{
      background: var(--card);
      border: 3px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .card::after{
      content:"";
      position:absolute;
      inset: -30% -20%;
      background: linear-gradient(135deg, rgba(255,79,163,0.16), rgba(255,240,201,0.16), rgba(201,243,255,0.16));
      transform: rotate(-10deg);
      pointer-events:none;
    }
    .card > *{ position:relative; z-index:1; }

    .left{ padding: 22px 22px 18px; }
    .right{ padding: 18px; display:flex; flex-direction:column; gap: 14px; justify-content:space-between; }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 2px solid var(--stroke);
      background: #fff7ff;
      width: fit-content;
      font-weight: 1000;
      letter-spacing: .2px;
    }
    .badge .dot{
      width: 10px; height:10px; border-radius: 50%;
      background: linear-gradient(180deg, var(--pink), var(--rose));
      box-shadow: 0 0 0 3px rgba(255,79,163,0.15);
    }

    h1{
      margin: 14px 0 10px;
      font-size: clamp(32px, 4.2vw, 52px);
      line-height: 1.03;
      letter-spacing: -0.6px;
    }
    .subtitle{
      margin: 0 0 14px;
      font-size: 15.5px;
      line-height: 1.5;
      color: var(--muted);
      font-weight: 700;
    }

    /* Letter / typewriter */
    .letterBox{
      margin-top: 12px;
      background: var(--cream);
      border: 3px dashed rgba(0,0,0,0.20);
      border-radius: 20px;
      padding: 14px 14px;
      box-shadow: 0 10px 0 rgba(0,0,0,0.07);
    }
    .type{
      font-weight: 950;
      font-size: 15px;
      color: rgba(0,0,0,0.82);
      border-right: 2px solid rgba(0,0,0,0.35);
      padding-right: 2px;
      animation: caret 1.05s steps(1) infinite;
      display:inline-block;
      min-height: 20px;
    }
    @keyframes caret{ 50%{ border-right-color: transparent; } }

    .divider{
      height: 3px;
      margin: 16px 0;
      background: repeating-linear-gradient(
        90deg,
        rgba(0,0,0,0.16) 0 16px,
        transparent 16px 26px
      );
      border-radius: 999px;
      opacity:.6;
    }

    /* Polaroid photos */
    .photos{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    @media (max-width: 520px){
      .photos{ grid-template-columns: repeat(2, 1fr); }
    }

    .polaroid{
      background: #fff;
      border: 3px solid var(--stroke);
      border-radius: 18px;
      box-shadow: 0 14px 0 rgba(0,0,0,0.07);
      overflow:hidden;
      transform: rotate(var(--r, 0deg));
      transition: transform .2s var(--ease);
      position:relative;
    }
    .polaroid:active{ transform: rotate(var(--r, 0deg)) scale(0.99); }

    .polaroid .tape{
      position:absolute;
      left: 50%;
      top: -10px;
      transform: translateX(-50%) rotate(-4deg);
      width: 64%;
      height: 22px;
      background: rgba(255,240,201,0.9);
      border: 2px solid rgba(0,0,0,0.14);
      border-radius: 10px;
      box-shadow: 0 8px 0 rgba(0,0,0,0.06);
      z-index:2;
    }

    .polaroid img{
      width:100%;
      height: 155px;
      object-fit:cover;
      display:block;
      background: linear-gradient(180deg, #ffe6f3, #fff7ea);
    }
    .polaroid .cap{
      padding: 10px 10px 12px;
      font-weight: 1000;
      color: rgba(0,0,0,0.70);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 8px;
    }
    .pill{
      font-size: 12px;
      font-weight: 1000;
      padding: 6px 10px;
      border-radius: 999px;
      border: 2px solid var(--stroke2);
      background: #fff7ff;
      box-shadow: 0 8px 0 rgba(0,0,0,0.05);
      white-space: nowrap;
    }

    /* Cute lists / notes */
    .sectionTitle{
      margin: 0 0 8px;
      font-size: 18px;
      font-weight: 1100;
    }
    .text{
      margin:0;
      color: var(--muted);
      font-weight: 750;
      line-height: 1.55;
      font-size: 14.6px;
    }

    .miniGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
    }
    @media (max-width: 520px){
      .miniGrid{ grid-template-columns: 1fr; }
    }

    .miniCard{
      background: #fff;
      border: 3px solid var(--stroke2);
      border-radius: 20px;
      padding: 12px 12px;
      box-shadow: 0 12px 0 rgba(0,0,0,0.06);
    }
    .miniCard .kicker{
      font-weight: 1100;
      margin-bottom: 6px;
    }

    /* Question */
    .question{
      padding: 14px 14px;
      border-radius: 22px;
      border: 3px solid var(--stroke);
      background: #ffffff;
      box-shadow: 0 16px 0 rgba(0,0,0,0.07);
    }
    .question h2{
      margin: 0 0 10px;
      font-size: clamp(22px, 2.6vw, 30px);
      line-height: 1.1;
      letter-spacing: -0.3px;
      font-weight: 1200;
    }

    .buttons{
      display:flex;
      gap: 12px;
      flex-wrap:wrap;
      margin-top: 10px;
      position:relative;
      min-height: 66px;
      touch-action: manipulation;
    }

    button.big{
      appearance:none;
      border:none;
      cursor:pointer;
      font-family: inherit;
      font-weight: 1200;
      letter-spacing: .2px;
      border-radius: 999px;
      padding: 14px 18px;
      min-width: 132px;
      box-shadow: 0 12px 0 rgba(0,0,0,0.08);
      transition: transform .18s var(--ease);
      user-select:none;
      position:relative;
      border: 3px solid var(--stroke);
      touch-action: manipulation;
    }
    button.big:active{ transform: translateY(4px); box-shadow: 0 8px 0 rgba(0,0,0,0.08); }

    .btnYes{
      background: linear-gradient(180deg, #ff79bd, #ff2f7d);
      color:#fff;
      transform-origin: center;
      animation: wobble 2.8s var(--ease) infinite;
    }
    @keyframes wobble{
      0%,100%{ transform: rotate(-1deg); }
      50%{ transform: rotate(1deg); }
    }

    .btnNo{
      background: linear-gradient(180deg, #fff, #fff2fb);
      color: rgba(0,0,0,0.78);
      position:absolute;
      left: 148px;
      top: 0;
    }

    .smallActions{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }
    .ghost{
      appearance:none;
      border: 3px solid var(--stroke);
      border-radius: 999px;
      background: #fff7ff;
      color: rgba(0,0,0,0.78);
      padding: 12px 14px;
      font-weight: 1200;
      box-shadow: 0 10px 0 rgba(0,0,0,0.07);
      cursor:pointer;
      touch-action: manipulation;
    }
    .ghost:active{ transform: translateY(3px); box-shadow: 0 7px 0 rgba(0,0,0,0.07); }

    .note{
      margin: 10px 0 0;
      font-size: 12.8px;
      color: rgba(0,0,0,0.62);
      font-weight: 750;
      line-height: 1.45;
    }

    /* Overlay */
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,0.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:50;
      padding: 16px;
    }
    .overlay.show{ display:flex; }

    .modal{
      width:min(760px, 100%);
      background: #fff;
      border-radius: 28px;
      border: 4px solid var(--stroke);
      box-shadow: 0 22px 0 rgba(0,0,0,0.10), 0 40px 90px rgba(0,0,0,0.25);
      overflow:hidden;
      position:relative;
    }

    .modalHeader{
      padding: 16px 16px 0;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap: 12px;
    }

    .modalHeader h3{
      margin:0;
      font-size: 22px;
      font-weight: 1200;
    }

    .close{
      min-width:auto;
      padding: 10px 12px;
      font-weight: 1200;
      border-radius: 999px;
      border: 3px solid var(--stroke);
      background: #fff7ff;
      box-shadow: 0 10px 0 rgba(0,0,0,0.07);
      cursor:pointer;
    }
    .close:active{ transform: translateY(3px); box-shadow: 0 7px 0 rgba(0,0,0,0.07); }

    .modalBody{
      padding: 12px 16px 16px;
      color: rgba(0,0,0,0.78);
      line-height: 1.6;
      font-size: 15.2px;
      font-weight: 800;
    }

    .bigYes{
      margin: 8px 0 4px;
      font-size: clamp(34px, 5vw, 54px);
      line-height:1;
      font-weight: 1300;
      color: transparent;
      background: linear-gradient(90deg, var(--rose), var(--purple), var(--pink));
      -webkit-background-clip: text;
      background-clip: text;
      text-shadow: 0 10px 0 rgba(0,0,0,0.06);
    }

    .confetti{
      position:absolute; inset:0;
      pointer-events:none;
      overflow:hidden;
    }
    .confetti i{
      position:absolute;
      font-style: normal;
      animation: fall 1.9s linear forwards;
      opacity: .95;
      filter: drop-shadow(0 10px 0 rgba(0,0,0,0.08)) drop-shadow(0 18px 30px rgba(0,0,0,0.22));
    }
    @keyframes fall{
      0%{ transform: translateY(-30px) rotate(0deg); opacity:0; }
      10%{ opacity:1; }
      100%{ transform: translateY(110vh) rotate(360deg); opacity:0; }
    }

    /* Footer */
    .footer{
      text-align:center;
      margin-top: 14px;
      color: rgba(0,0,0,0.58);
      font-weight: 850;
      font-size: 13px;
    }

    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; }
      canvas{ display:none; }
    }
  </style>
</head>

<body>
  <div class="sticker s1" style="--r:-12deg">üíñ</div>
  <div class="sticker s2" style="--r:10deg">üíò</div>
  <div class="sticker s3" style="--r:8deg">‚ú®</div>
  <div class="sticker s4" style="--r:-8deg">üíù</div>

  <!-- Banner appears if autoplay is blocked -->
  <div class="topBanner" id="topBanner" role="button" aria-label="Tap to start music">
    <div class="msg">Tap once to start the music üé∂ (phones block autoplay)</div>
    <button id="startMusicBtn">Start</button>
  </div>

  <canvas class="layer" id="heartsCanvas"></canvas>
  <canvas class="layer" id="sparkleCanvas"></canvas>

  <main class="wrap">
    <section class="shell">

      <!-- LEFT -->
      <div class="card left">
        <div class="badge"><span class="dot"></span> a little love letter</div>

        <h1>Hey <span id="herName">Natasha</span>,</h1>
        <p class="subtitle" id="subLine">
          I made this for you because you deserve something sweet, silly, and full of love.
        </p>

        <div class="letterBox" aria-live="polite">
          <span id="typeTarget" class="type"></span>
        </div>

        <div class="divider"></div>

        <h2 class="sectionTitle">A few things I adore about you üíó</h2>
        <div class="miniGrid">
          <div class="miniCard">
            <div class="kicker">Your smile</div>
            <p class="text">It does that thing where it makes everything feel okay.</p>
          </div>
          <div class="miniCard">
            <div class="kicker">Your vibe</div>
            <p class="text">Soft, strong, and beautiful ‚Äî the kind you don‚Äôt forget.</p>
          </div>
          <div class="miniCard">
            <div class="kicker">Your heart</div>
            <p class="text">You care in a way that feels rare. I notice. Always.</p>
          </div>
          <div class="miniCard">
            <div class="kicker">The way you are</div>
            <p class="text">You‚Äôre the kind of person I‚Äôd choose on purpose.</p>
          </div>
        </div>

        <div class="divider"></div>

        <h2 class="sectionTitle">Little photo corner üì∏</h2>
        <p class="text" style="margin-bottom:10px;">(Your pictures are here ‚Äî like cute polaroids.)</p>

        <div class="photos">
          <div class="polaroid" style="--r:-1.5deg">
            <div class="tape"></div>
            <img src="images/her1.jpeg" alt="Photo 1" onerror="this.style.display='none'">
            <div class="cap">
              <span>my favorite</span>
              <span class="pill">us ‚ú®</span>
            </div>
          </div>

          <div class="polaroid" style="--r:1.2deg">
            <div class="tape"></div>
            <img src="images/her2.jpeg" alt="Photo 2" onerror="this.style.display='none'">
            <div class="cap">
              <span>pretty girl</span>
              <span class="pill">smile ü´∂</span>
            </div>
          </div>

          <div class="polaroid" style="--r:-0.8deg">
            <div class="tape"></div>
            <img src="images/her3.jpeg" alt="Photo 3" onerror="this.style.display='none'">
            <div class="cap">
              <span>my peace</span>
              <span class="pill">forever üíû</span>
            </div>
          </div>
        </div>

        <p class="note">
          If your images are named differently, update the <b>src</b> paths above.
          (Your current ones are <b>.jpeg</b>, not .jpg.)
        </p>

        <div class="footer">Made for Natasha Chipo Yolanda Hongoro üíò</div>
      </div>

      <!-- RIGHT -->
      <div class="card right">
        <div>
          <h2 class="sectionTitle">Today‚Äôs mood:</h2>
          <p class="text">
            I‚Äôm thinking about you. A lot. Like‚Ä¶ a ridiculous amount.
          </p>

          <div class="divider"></div>

          <h2 class="sectionTitle">Tiny notes I‚Äôd tell you in person üìù</h2>
          <div class="miniGrid">
            <div class="miniCard">
              <div class="kicker">Note #1</div>
              <p class="text">You look good in every version of yourself.</p>
            </div>
            <div class="miniCard">
              <div class="kicker">Note #2</div>
              <p class="text">You‚Äôre not ‚Äútoo much.‚Äù You‚Äôre exactly enough.</p>
            </div>
            <div class="miniCard">
              <div class="kicker">Note #3</div>
              <p class="text">If I had to pick again, I‚Äôd still pick you.</p>
            </div>
            <div class="miniCard">
              <div class="kicker">Note #4</div>
              <p class="text">Being with you feels like home‚Ä¶ but cuter.</p>
            </div>
          </div>

          <div class="divider"></div>

          <div class="question">
            <h2>Will you be my Valentine? üíå</h2>
            <p class="text" id="promptLine">
              (Pick the cute answer üòåüíó)
            </p>

            <div class="buttons" id="btnArea">
              <button class="big btnYes" id="yesBtn">Yes üíñ</button>
              <button class="big btnNo" id="noBtn">No üôà</button>
            </div>

            <div class="smallActions">
              <button class="ghost" id="openLetterBtn">Open my letter ‚úçÔ∏è</button>
              <button class="ghost" id="musicBtn">Music: on üé∂</button>
            </div>

            <p class="note" id="tinyNote">
              (If she tries ‚ÄúNo‚Äù‚Ä¶ it gets shy and runs away.)
            </p>
          </div>
        </div>

        <p class="note" style="margin:0;">
          Built with love + extra kisses üíï
        </p>
      </div>

    </section>
  </main>

  <!-- YES overlay -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal">
      <div class="confetti" id="confetti"></div>
      <div class="modalHeader">
        <div>
          <h3 id="modalTitle">Yayyy üíû</h3>
          <div class="bigYes">It‚Äôs a YES!</div>
        </div>
        <button class="close" id="closeOverlay">Close</button>
      </div>

      <div class="modalBody" id="modalBody">
        <p style="margin-top:0;">
          Natasha Chipo Yolanda Hongoro,
        </p>
        <p>
          I like you more than I can explain properly ‚Äî so I made this instead.
          You make me feel calm, lucky, and stupidly happy.
        </p>
        <p>
          I love your energy, your smile, and the way you carry yourself.
          You‚Äôre genuinely special to me.
        </p>
        <p style="margin-bottom:0;">
          Be my Valentine? I‚Äôll bring the kisses and the plans. üíó
        </p>
      </div>
    </div>
  </div>

  <!-- MUSIC (always-on attempt) -->
  <audio id="bgm" loop preload="auto" playsinline>
    <!-- Put your file at: music/love.mp3 -->
    <source src="music/love.mp3" type="audio/mpeg" />
  </audio>

  <script>
    /* =========================
       PERSONALIZE
       ========================= */
    const HER_NAME = "Natasha Chipo Yolanda Hongoro";

    const TYPEWRITER_LINES = [
      "Natasha‚Ä¶",
      "I‚Äôm not trying to be dramatic,",
      "but you‚Äôve been on my mind nonstop.",
      "You make my days softer.",
      "So I just want to ask you‚Ä¶",
      "Will you be my Valentine? üíò"
    ];

    const NO_BUTTON_LINES = [
      "Eish‚Ä¶ are you sure? üò≥",
      "That one hurts a little ü•∫",
      "Come on‚Ä¶ just one Yes üíó",
      "The No button is shy üòÖ",
      "Okay okay‚Ä¶ last try üòå",
      "Pick the cute answer üò≠üíò"
    ];

    /* =========================
       DOM
       ========================= */
    const herNameEl = document.getElementById("herName");
    const typeTarget = document.getElementById("typeTarget");

    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const btnArea = document.getElementById("btnArea");
    const promptLine = document.getElementById("promptLine");
    const tinyNote = document.getElementById("tinyNote");

    const overlay = document.getElementById("overlay");
    const closeOverlay = document.getElementById("closeOverlay");
    const confetti = document.getElementById("confetti");

    const openLetterBtn = document.getElementById("openLetterBtn");
    const musicBtn = document.getElementById("musicBtn");
    const bgm = document.getElementById("bgm");

    const topBanner = document.getElementById("topBanner");
    const startMusicBtn = document.getElementById("startMusicBtn");

    herNameEl.textContent = HER_NAME;

    /* =========================
       TYPEWRITER
       ========================= */
    function wait(ms){ return new Promise(r => setTimeout(r, ms)); }

    async function typeLine(text, el){
      return new Promise(resolve => {
        let i = 0;
        const speed = 28;
        const t = setInterval(() => {
          el.textContent = text.slice(0, i++);
          if (i > text.length){
            clearInterval(t);
            resolve();
          }
        }, speed);
      });
    }

    async function typewriter(lines, el){
      el.textContent = "";
      for (const line of lines){
        await typeLine(line, el);
        await wait(700);
        el.textContent = "";
      }
      await typeLine("Will you be my Valentine? üíò", el);
    }

    typewriter(TYPEWRITER_LINES, typeTarget);

    /* =========================
       MUSIC: best-effort always-on
       ========================= */
    let musicOn = true;

    async function tryStartMusic(){
      try{
        bgm.volume = 0.85;
        await bgm.play();
        topBanner.classList.remove("show");
        musicBtn.textContent = "Music: on üé∂";
        musicOn = true;
        return true;
      } catch (e){
        // blocked by mobile autoplay policy
        topBanner.classList.add("show");
        musicBtn.textContent = "Music: tap to start üé∂";
        musicOn = false;
        return false;
      }
    }

    // Attempt immediately
    tryStartMusic();

    // Start music on first interaction anywhere
    function unlockAudioOnce(){
      tryStartMusic();
      window.removeEventListener("pointerdown", unlockAudioOnce);
      window.removeEventListener("touchstart", unlockAudioOnce);
      window.removeEventListener("click", unlockAudioOnce);
    }
    window.addEventListener("pointerdown", unlockAudioOnce, { once:false });
    window.addEventListener("touchstart", unlockAudioOnce, { once:false, passive:true });
    window.addEventListener("click", unlockAudioOnce, { once:false });

    // Banner start button
    startMusicBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      unlockAudioOnce();
    });
    topBanner.addEventListener("click", (e) => {
      e.stopPropagation();
      unlockAudioOnce();
    });

    // Music toggle
    musicBtn.addEventListener("click", async () => {
      if (musicOn){
        bgm.pause();
        musicOn = false;
        musicBtn.textContent = "Music: off üîá";
      } else {
        await tryStartMusic();
      }
    });

    /* =========================
       NO BUTTON DODGE (mobile-friendly)
       ========================= */
    let noIndex = 0;
    let noDodges = 0;

    function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }

    function dodgeNoButton(){
      const area = btnArea.getBoundingClientRect();
      const btn = noBtn.getBoundingClientRect();

      if (area.height < 80) btnArea.style.minHeight = "100px";

      const pad = 6;
      const maxX = area.width - btn.width - pad;
      const maxY = area.height - btn.height - pad;

      const x = Math.random() * maxX;
      const y = Math.random() * maxY;

      noBtn.style.left = `${clamp(x, pad, maxX)}px`;
      noBtn.style.top  = `${clamp(y, pad, maxY)}px`;

      noDodges++;
      promptLine.textContent = NO_BUTTON_LINES[noIndex % NO_BUTTON_LINES.length];
      noIndex++;

      if (noDodges >= 4) tinyNote.textContent = "(This is basically the universe pushing you to Yes üòåüíó)";
    }

    // Use touch + click (hover doesn't exist on mobile)
    noBtn.addEventListener("touchstart", (e) => { e.preventDefault(); dodgeNoButton(); }, {passive:false});
    noBtn.addEventListener("click", (e) => { e.preventDefault(); dodgeNoButton(); });

    /* =========================
       YES OVERLAY
       ========================= */
    yesBtn.addEventListener("click", () => {
      overlay.classList.add("show");
      launchConfettiHearts(60);
      intensifyHearts(1.7);
    });

    closeOverlay.addEventListener("click", () => overlay.classList.remove("show"));
    overlay.addEventListener("click", (e) => {
      if (e.target === overlay) overlay.classList.remove("show");
    });

    openLetterBtn.addEventListener("click", () => {
      overlay.classList.add("show");
      launchConfettiHearts(30);
    });

    /* =========================
       CONFETTI
       ========================= */
    function launchConfettiHearts(count){
      confetti.innerHTML = "";
      const hearts = ["üíñ","üíò","üíó","üíû","üíù","üíï","‚ú®"];
      for (let i=0;i<count;i++){
        const el = document.createElement("i");
        el.textContent = hearts[Math.floor(Math.random()*hearts.length)];
        el.style.left = Math.random()*100 + "%";
        el.style.top = (-10 - Math.random()*20) + "px";
        el.style.fontSize = (16 + Math.random()*26) + "px";
        el.style.animationDuration = (1.4 + Math.random()*1.4) + "s";
        confetti.appendChild(el);
      }
    }

    /* =========================
       CANVAS HEARTS + SPARKLES
       ========================= */
    const heartsCanvas = document.getElementById("heartsCanvas");
    const sparkleCanvas = document.getElementById("sparkleCanvas");
    const hctx = heartsCanvas.getContext("2d");
    const sctx = sparkleCanvas.getContext("2d");

    let W, H, DPR;
    function resize(){
      DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      W = window.innerWidth;
      H = window.innerHeight;

      heartsCanvas.width = Math.floor(W * DPR);
      heartsCanvas.height = Math.floor(H * DPR);
      heartsCanvas.style.width = W + "px";
      heartsCanvas.style.height = H + "px";
      hctx.setTransform(DPR,0,0,DPR,0,0);

      sparkleCanvas.width = Math.floor(W * DPR);
      sparkleCanvas.height = Math.floor(H * DPR);
      sparkleCanvas.style.width = W + "px";
      sparkleCanvas.style.height = H + "px";
      sctx.setTransform(DPR,0,0,DPR,0,0);
    }
    window.addEventListener("resize", resize);
    resize();

    const heartGlyphs = ["üíó","üíñ","üíò","üíï","üíù","üíû"];
    const hearts = [];
    const sparkles = [];
    let heartRate = 1.0;
    function intensifyHearts(mult){ heartRate = mult; }

    function spawnHeart(){
      hearts.push({
        x: Math.random()*W,
        y: H + 20,
        s: 16 + Math.random()*18,
        v: 0.55 + Math.random()*1.1,
        drift: (Math.random()*2 - 1) * 0.55,
        a: 0.65 + Math.random()*0.25,
        rot: Math.random()*Math.PI*2,
        rV: (Math.random()*2-1)*0.02,
        g: heartGlyphs[Math.floor(Math.random()*heartGlyphs.length)]
      });
    }

    function spawnSparkle(x, y){
      sparkles.push({
        x, y,
        r: 1 + Math.random()*2.6,
        a: 0.9,
        v: 0.6 + Math.random()*1.1,
        dx: (Math.random()*2-1)*0.9,
        dy: (Math.random()*2-1)*0.9
      });
    }

    function draw(){
      requestAnimationFrame(draw);

      hctx.clearRect(0,0,W,H);

      const spawnCount = Math.random() < (0.22 * heartRate) ? 1 : 0;
      for (let i=0;i<spawnCount;i++) spawnHeart();

      for (let i=hearts.length-1;i>=0;i--){
        const p = hearts[i];
        p.y -= p.v;
        p.x += p.drift;
        p.rot += p.rV;

        if (Math.random() < 0.07) spawnSparkle(p.x, p.y);

        hctx.save();
        hctx.globalAlpha = p.a;
        hctx.translate(p.x, p.y);
        hctx.rotate(p.rot);
        hctx.font = `${p.s}px ${getComputedStyle(document.body).fontFamily}`;
        hctx.textAlign = "center";
        hctx.textBaseline = "middle";
        hctx.fillText(p.g, 0, 0);
        hctx.restore();

        if (p.y < -40 || p.x < -60 || p.x > W+60) hearts.splice(i,1);
      }

      sctx.clearRect(0,0,W,H);
      for (let i=sparkles.length-1;i>=0;i--){
        const sp = sparkles[i];
        sp.a -= 0.02;
        sp.x += sp.dx * 0.4;
        sp.y += sp.dy * 0.4;
        sp.r += sp.v * 0.05;

        sctx.save();
        sctx.globalAlpha = Math.max(0, sp.a);
        sctx.beginPath();
        sctx.arc(sp.x, sp.y, sp.r, 0, Math.PI*2);
        sctx.fillStyle = "rgba(255,255,255,1)";
        sctx.fill();
        sctx.restore();

        if (sp.a <= 0) sparkles.splice(i,1);
      }
    }
    draw();

    // Sparkles on tap
    window.addEventListener("pointerdown", (e) => {
      for (let i=0;i<10;i++) spawnSparkle(e.clientX + (Math.random()*14-7), e.clientY + (Math.random()*14-7));
    });

    /* Make No button initial position nice on small screens */
    (function initNoPos(){
      const area = btnArea.getBoundingClientRect();
      noBtn.style.left = area.width < 360 ? "0px" : "148px";
      noBtn.style.top = area.width < 360 ? "66px" : "0px";
    })();
  </script>
</body>
</html>
